Node.js가 프로그래머에게 주는 의미
==================================

웹 2.0 시대는 웹 사이트를 웹 응용프로그램으로 진화시켰고 진화는 클라이언트 측에서 또 서버 측에서 여전히 진행 중이다. 이러한 변화의 흐름 속에 웹 브라우저에서 가장 큰 역할을 담당하고 있는 기술 중 하나가 프로그래밍 언어인 자바스크립트라는 것에 이의를 제기할 프로그래머는 많지 않을 것이다. 엄청난 속도의 인터넷 보급, 그리고 스마트폰과 태블릿의 확산은 자바스크립트가 수를 헤아릴 수 없이 많은 기기에서 실행되도록 만들었다. 집에서, 사무실에서, 출퇴근길 대중교통 안에서, 식당이나 카페에서 수많은 사람들이 PC로, 노트북으로, 그리고 스마트폰과 태블릿으로 인터넷에 접속하여 원하는 정보를 검색하고 음악과 영화를 감상하고 게임을 즐긴다. 이러한 활동의 중심에 자바스크립트가 끊임 없이 동작하고 있다.

IT 혁명의 중심에 있는 웹 플랫폼 위에서 구동되는 프로그램을 개발하는 수많은 프로그래머들은 자바스크립트에 매우 익숙하다. 이들이 웹 클라이언트가 아닌 경험해보지 못했던 생소한 환경에서 구동되는 프로그램을 작성할 때 이미 익숙한 프로그래밍 언어를 사용할 수 있다면 얼마나 반가울까? 자바스크립트는 지금 웹 브라우저를 벗어나 그 영향력이 빠르게 확대되고 있기 때문에 자바스크립트에 친숙한 웹 클라이언트 프로그래머들에게 지금은 새로운 플랫폼에 도전하기에 아주 좋은 기회이다.

자바스크립트로 한 벌의 코드를 작성하면 여러 모바일 플랫폼용 코드를 빌드 할 수 있는 개발 도구가 시중에 판매되고 있고, 윈도 8과 마이크로소프트 오피스에서 구동되는 프로그램을 자바스크립트로 작성할 수 있는 시대이다. 하지만 그 어떤 플랫폼보다 자바스크립트가 네트워크 서버 프로그래밍 환경에 진출했다는 것이야 말로 가장 혁명적이고 가장 주목해야 할 부분이 아닐까 생각된다. 바로 Node.js가 그것을 가능케 한다.

Node.js는 확장 가능한 고성능 네트워크 서버 코드를 빠르고 간결하게 작성할 수 있게 해주는 플랫폼이다. 바로 자바스크립트라는 프로그래밍 언어를 사용해서 말이다. 자바스크립트를 사용한 클라이언트 개발이 주력인 프로그래머들 중 다수는 서버 프로그래밍 세계로의 영역 확대에 큰 장벽이 있었을 수도 있다. 기존 서버 프로그래밍 환경의 좀 더 안정적이지만 경직된 문법의 언어, 다중 스레드 프로그래밍, 고효율 코드 작성 등 이전에 경험해보지 못했던 몇몇 기술과 문화가 막연한 두려움으로 느껴지는 개발자들도 있었을 것이다. 하지만 Node.js로 인해 웹 클라이언트에 익숙한 개발자들이 기존이 익히고 있던 기술과 코딩 문화를 그대로 서버 영역으로 확대할 수 있는 기회가 생겼다.

그러면 Node.js의 어떤 특징이 웹 브라우저가 주 활동 무대였던 자바스크립트를 네트워크 서버 환경에 적합한 언어의 반열에 오르게 한 것일까? 각자 여러 가지 이유들이 떠오르겠지만 필자는 기존의 것들에 비해 혁명적인 성능을 보여준 Chrome 웹 브라우저의 자바스크립트 엔진인 V8과 비동기 프로그래밍 모델이 아닐까 생각한다. 이것들을 비롯해 Node.js의 특징들에 대해서 좀 더 얘기할 필요가 있다.

Node.js의 주요 특징
===================

JavaScript의 유연성
-------------------

Node.js는 자바스크립트 언어 기반의 개발 플랫폼이다. 자바스크립트가 웹 클라이언트 개발 언어로 오랫동안 흔들림 없이 입지를 굳힐 수 있었던 것은 외부 요인도 있겠지만 자바스크립트만의 매력이 분명 크게 작용했을 것이다. 프로그래밍 언어를 나누는 기준에는 여러 가지가 있다. 그 중 하나가 정적 언어와 동적 언어로 나누는 기준이다. 정적 언어로 대표적인 것은 C, C++, Java, C# 등이 있다. 이들 언어는 개체가 생성되는 시점에 개체의 형식이 결정되고 이 형식이 정의하고 있는 속성과 행위를 가지게 되면 개체가 수명을 다 할 때까지 속성과 행위가 추가되거나 삭제되지 않는다. 반면 자바스크립트는 동적 언어이다. 자바스크립트 개체는 만들어질 때 미리 정해진 형식에 의해 속성과 행위가 정의되지 않으며 개체의 수명주기 중 속성과 행위는 얼마든지 추가되고 제거될 수 있다. 프로그래머는 자바스크립트의 이러한 특성을 이용해 좀 더 민첩하게 주어진 상황에 대처할 수 있다.

또 자바스크립트는 즉각적인 콜백(callback) 함수를 정의할 수 있도록 클로저(closure)를 구현한다. 함수 블록 안에서 또 다른 내부 함수를 만드는 이 기능은 내부 함수가 부모 함수의 접근 범위에 있는 데이터에 접근할 수 있도록 허용함으로써 프로그래머가 유연하고 간결한 코드를 작성할 수 있게 한다.

이러한 유연성은 자바스크립트를 웹 클라이언트에서 구동되기에 적합한 언어로 만들었고 이제는 Node.js를 통해 서버 프로그램 개발에도 이러한 유연성을 활용할 수 있게 되었다. 현대의 소프트웨어는 고정적이지 않다. 오히려 살아 숨쉬며 끊임 없이 변화하는 존재에 가깝다. 이런 환경에 대처하기에 자바스크립트가 가진 유연함은 Node.js와 서버 프로그래머에게 큰 힘이 된다.

고성능 JavaScript엔진 V8
------------------------

V8은 Google이 웹 브라우저 Chrome을 위해 개발한 오픈 소스 자바스크립트 엔진이다. 고성능, 고효율 자바스크립트 실행 환경은 새로운 웹 브라우저로서의 Chrome이 가진 가장 중요한 과제 중 하나였다. 그 이유는 웹 표준 기술에 기반한 웹 응용프로그램의 사용자 경험을 극대화하기에 기존 브라우저의 자바스크립트 엔진의 성능은 충분하지 않았기 때문이다. Chrome은 높은 성능의 자바스크립트엔진 V8을 탑재해 Chrome 브라우저를 사용하는 것 만으로도 이미 전 세계에 배포되어있는 수많은 자바스크립트 기반 웹 응용프로그램의 사용자 경험을 높일 수 있었다. Chrome은 처음 세상에 공개되던 당시 가장 점유율이 높았던 브라우저인 Internet Explorer와 비교해 정말 믿기 어려운 자바스크립트 실행 속도를 보여줬다.

V8은 자바스크립트 코드를 인터프리터로 통역(interpret)하거나 중간 언어로 번역(compile)하는 기존의 방법 대신 각 코드를 실행하기 전 각 플랫폼에 최적화된 기계어로 번역하고 이를 캐시에 보관해 재사용한다. 그리고 외부로 드러나지는 않지만 가능한 경우 자바스크립트가 가진 동적 언어로서의 특징과 상반되는 형식 기반 멤버 바인딩을 내부적으로 사용한다. 이외에도 다양한 방법들을 사용해 V8은 자바스크립트 프로그램의 성능을 컴파일 언어로 작성된 프로그램의 성능과 아주 가까운 위치까지 끌어올린다. 물론 이러한 V8의 동작 원리를 잘 이해하면 좀 더 효율적이고 높은 성능을 내는 프로그램을 작성할 수 있지만 필수적으로 알아야 할 내용은 아니다. 기존에 사용하던 방법대로 자바스크립트 코드를 작성해도 대부분의 경우 V8은 충분한 성능을 제공한다.

비동기 이벤트 방식
------------------

비동기 이벤트 프로그래밍 모델은 클라이언트에서든 서버에서든 자바스크립트 프로그래머가 반드시 이해해야 할 개념 중 하나이다. 웹 클라이언트 자바스크립트 프로그래머라면 혹여 용어가 생소하더라고 걱정할 필요가 전혀 없다. XMLHttpRequest 개체를 통해 이미 이러한 기법을 익숙하게 사용하고 있었을 테니까.

XMLHttpRequest를 사용한 비동기 처리 과정에 대해 잠깐 살펴보자. 웹 브라우저에서 구동되는 자바스크립트는 단일 스레드 모델을 채택한다. 웹 브라우저가 컨트롤을 통해 사용자의 입력을 받아들이고 브라우저 화면을 그리는 등의 작업이 이루어지는 스레드를 자바스크립트가 공유하는 방식이다. 바꿔 말하면 자바스크립트가 사용하는 스레드는 자바스크립트에게 뿐만 아니라 웹 브라우저에게도 매우 소중한 자원인 것이다. 자바스크립트의 각 작업은 이 하나의 스레드 안에서 프레임이란 단위로 나뉘어 처리된다. 그래서 자바스크립트가 하나의 프레임 안에서 오랫동안 작업을 처리하면 해당 작업이 모두 완료될 때까지 웹 브라우저는 사용자의 입력을 받아들이거나 화면을 갱신할 수 없는 상태로 멈춰있게 된다. 그렇기 때문에 XMLHttpRequest를 사용해 웹 서버와 통신할 때 요청을 보낸 후 서버의 응답을 수신할 때까지 프레임에서 기다리기는 동기적 방식보다는 최대한 신속히 스레드 점유를 다음 프레임 또는 웹 브라우저에 양보하고 서버로부터 응답이 오면 그 때 새로운 프레임을 할당 받아 이후 작업을 처리하는 비동기적 방식을 사용한다.

Node.js 역시 하나의 프로그램 인스턴스는 하나의 스레드만 사용한다. Node.js 프로그램은 일반적으로 모든 외부 컴포넌트와 의사 소통할 때 비동기 방식을 사용해 대기 시간 동안의 자원 낭비를 최소화한다. 그러면 왜 기존의 플랫폼에서 개발하는 프로그래머들은 자원을 경제적으로 활용할 수 있는 비동기 프로그래밍 모델을 사용하지 않는 걸까? Node.js 창시자인 Ryan Lienhart Dahl은 두 가지 이유를 제시한다.

하나는 개발 인프라 부족이다. 기존 개발 플랫폼에서 사용되는 많은 라이브러리들이 비동기 프로그래밍을 지원하지 않는다는 얘기다. 하지만 이 의견은 어떤 환경에서는 적합하지만 또 어떤 환경에서는 딱 들어맞는 얘기는 아니다. 예를 들어 ASP.NET은 언제나 비동기 프로그래밍 도구를 지원해 왔고 점차 확대 되었지만 아직도 많은 프로그래머들은 동기적 방식의 프로그래밍만을 사용한다. 왜 일까? Ryan Dahl은 많은 플랫폼에서 비동기 프로그래밍이 주류가 되지 않는 또 다른 이유로 문화적 차이를 얘기한다.

이미 비동기 프로그래밍 지원이 존재한다 하더라도 동기적 방식이 훨씬 오랫동안 자리잡고 있었고 최근까지 비동기 프로그래밍은 프로그래머에게 동기적 방식에 비해 더 깊은 사고와 더 많은 양의 코드를 요구했다는 것은 부정하기 힘들다. 동기적 방식과 비동기적 방식 모두를 제공하는 인프라에서 프로그래머들이 비교적 손쉬운 동기적 프로그래밍을 선호하는 경우가 많았다. 반면 대부분의 Node.js 입출력 모듈은 비동기 방식만을 지원하고 이미 언급했듯이 기존의 자바스크립트 프로그래머들은 이러한 방식에 매우 익숙하다. Node.js는 태생적으로 고효율 비동기 프로그래밍에 필요한 문화적 환경을 갖추고 있다고 봐도 무리가 없을 것이다.

단일 스레드 모델
----------------

npm
---

Node.js의 단점과 극복 방법
==========================

컴파일러 지원 부재
------------------

단일 스레드 모델
----------------

콜백 지옥
---------

결론
====
